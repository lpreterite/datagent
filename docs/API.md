<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Agent][1]
    -   [Parameters][2]
    -   [Properties][3]
    -   [Examples][4]
    -   [active][5]
        -   [Parameters][6]
    -   [fetch][7]
        -   [Parameters][8]
    -   [find][9]
        -   [Parameters][10]
    -   [save][11]
        -   [Parameters][12]
    -   [destroy][13]
        -   [Parameters][14]
    -   [on][15]
        -   [Parameters][16]
-   [Agent#before][17]
    -   [Properties][18]
-   [Agent#error][19]
-   [Agent#after][20]
    -   [Properties][21]
-   [Contact][22]
    -   [Parameters][23]
    -   [Examples][24]
    -   [has][25]
        -   [Parameters][26]
    -   [default][27]
        -   [Parameters][28]
    -   [remote][29]
        -   [Parameters][30]
        -   [Examples][31]
-   [Model][32]
    -   [Parameters][33]
    -   [Properties][34]
    -   [Examples][35]
    -   [fetch][36]
        -   [Parameters][37]
    -   [find][38]
        -   [Parameters][39]
    -   [save][40]
        -   [Parameters][41]
    -   [destroy][42]
        -   [Parameters][43]
-   [hooks][44]
    -   [respondData][45]
        -   [Examples][46]
    -   [formatFor][47]
        -   [Parameters][48]
        -   [Examples][49]
    -   [filterFor][50]
        -   [Parameters][51]
        -   [Examples][52]
-   [axios][53]
-   [axios.config][54]
-   [Remote][55]
    -   [Parameters][56]
    -   [Properties][57]
    -   [Examples][58]
    -   [sync][59]
        -   [Parameters][60]
    -   [get][61]
        -   [Parameters][62]
    -   [post][63]
        -   [Parameters][64]
    -   [put][65]
        -   [Parameters][66]
    -   [patch][67]
        -   [Parameters][68]
    -   [delete][69]
        -   [Parameters][70]
-   [Schema][71]
    -   [Parameters][72]
    -   [Properties][73]
    -   [Examples][74]
    -   [serialize][75]
        -   [Examples][76]
    -   [format][77]
        -   [Parameters][78]
        -   [Examples][79]
    -   [filter][80]
        -   [Parameters][81]
        -   [Examples][82]

## Agent

数据对象代理，提供方法执行前后事件通知。

### Parameters

-   `_models` **[Array][83]&lt;[Object][84]>** 
-   `options` **[Object][84]** 

### Properties

-   `models` **[Object][84]** 

### Examples

```javascript
import axios from "axios"
import datagent from "datagent"

const contact = datagent.contact({ base: axios.create({ baseURL: "http://localhost:8081"  }) })
const userModel = datagent.model({ name: 'user', contact })
const roleModel = datagent.model({ name: 'role', contact })
const agent = datagent.agent([userModel, roleModel])

// 记录加载状态
const loader = { [userModel.name]:false, [roleModel.name]:false }
;(async ()=>{
  agent.on("error", err=>console.error(err))
  agent.on("before", ctx=>loader[ctx.model_name] = true) //改为加载中
  agent.on("after", (err, result, ctx)=>loader[ctx.model_name] = false) //改为加载完成

  const [err, user_res] = await agent.fetch(userModel.name, { q: "pa" })
  // request 'http://localhost:8081/user?q=pa'
  // output respond like: { status: 200, data: {...}, headers: {...} }
  const [err, role_res] = await agent.fetch(userModel.name, { id: user_res.data.user.role_id })
  // request 'http://localhost:8081/role?q=pa'
  // output respond like: { status: 200, data: {...}, headers: {...} }
})
```

### active

执行对应的模型对象方法

#### Parameters

-   `model_name` **[String][85]** 模型对象名称
-   `action` **[String][85]** 模型对象方法名
-   `query` **any** 传入方法的参数
-   `options` **any** 传入方法的设置

Returns **[Promise][86]** 

### fetch

获取多条数据

#### Parameters

-   `model_name` **[String][85]** 模型对象名称
-   `query` **any** 传入方法的参数
-   `options` **any** 传入方法的设置

Returns **[Promise][86]** 

### find

获取单条数据

#### Parameters

-   `model_name` **[String][85]** 模型对象名称
-   `query` **[Object][84]** 传入方法的参数
    -   `query.id` **[String][85]** 必须传入id
-   `options` **any** 传入方法的设置

Returns **[Promise][86]** 

### save

保存数据

默认发起`[POST]`请求，传入数据如果带上`id`参数将会发起`[PUT]`请求

#### Parameters

-   `model_name` **[String][85]** 模型对象名称
-   `query` **any** 传入方法的参数
-   `options` **any** 传入方法的设置

Returns **[Promise][86]** 

### destroy

销毁数据

#### Parameters

-   `model_name` **[String][85]** 模型对象名称
-   `query` **[Object][84]** 传入方法的参数
    -   `query.id` **[String][85]** 必须传入id
-   `options` **any** 传入方法的设置

Returns **[Promise][86]** 

### on

设置事件回调

#### Parameters

-   `event_name` **[String][85]** 事件名称
-   `cb` **[Function][87]** 回调参数

Returns **[Promise][86]** 

## Agent#before

执行对象方法前的事件

Type: [Object][84]

### Properties

-   `model_name` **[String][85]** 模型对象名称
-   `action` **[String][85]** 模型对象方法名
-   `query` **any** 传入方法的参数
-   `options` **any** 传入方法的设置

## Agent#error

执行对象方法后出错的事件

Type: [Error][88]

## Agent#after

执行对象方法后的事件

### Properties

-   `err` **[Error][88]** 错误
-   `result` **[Object][84]** 返回结果，默认返回的是`respond`对象
-   `ctx` **[Object][84]** 执行上下文，参考Agent#before中的上下文参数

## Contact

链接管理器

### Parameters

-   `remotes` **any**  (optional, default `{}`)
-   `options`  

### Examples

```javascript
import axios from "axios"
import datagent from "datagent"
const contact = datagent.contact({ base: axios.create({ baseURL: 'http://localhost:8081' }) })

console.log('contact has test:'+contact.has('test'))
// output: 'contact has test:false'

// use default remote
console.log(contact.default().get('/user'))
// request 'http://localhost:8081/user'
// output respond like: { status: 200, data: {...}, headers: {...} }

// set nothing parmas will get default remote with remote function
console.log(contact.remote().get('/user'))
// request 'http://localhost:8081/user'
// output respond like: { status: 200, data: {...}, headers: {...} }
```

### has

判断是否存在远端

#### Parameters

-   `name` **[String][85]** 远端名称

Returns **[Boolean][89]** true 存在, false 不存在

### default

获取或设定默认远端

#### Parameters

-   `name` **[String][85]?** 远端名称，不传参为获取默认远端

Returns **[Remote][90]** 返回默认远端

### remote

获取或设定远端

#### Parameters

-   `args` **[Array][83]** 
    -   `args[].name` **[String][85]** 远端名称，不传参为获取默认远端
    -   `args[].remote` **[Remote][90]** 远端，不传参为获取远端

#### Examples

```javascript
//获得默认远端
contact.remote()
//获得远端
contact.remote('base')
//设置远端
contact.remote('test', datagent.remote(axios.create({ baseURL: "http://localhost:8082" })))
```

Returns **[Remote][90]** 返回默认远端

## Model

数据对象

### Parameters

-   `options` **[Object][84]** 
    -   `options.name` **[String][85]** 对象名称; 必需，用于拼接请求地址
    -   `options.url` **[String][85]?** 请求地址; 可选，用于发起请求
    -   `options.contact` **[Contact][91]** 链接管理器; 必需，用于发起请求
    -   `options.methods` **[Object][84]** 对象方法集合; 可选，设置对象的自定义方法
    -   `options.hooks` **[Object][84]** 对象方法的钩子集合; 可选，设置对象方法的钩子处理
    -   `options.emulateIdKey` **[Boolean][89]** 默认为`false`; 可选，默认行为是不将`id`作为请求数据发送并将`id`拼接至请求地址，如：`http://localhost/user/10422`

### Properties

-   `name` **[String][85]** 对象名称；可更改
-   `url` **[String][85]** 请求地址；可更改
-   `contact` **[Contact][91]** 链接管理器；可更改

### Examples

```javascript
import axios from "axios"
import datagent from "datagent"
const { respondData } = datagent.hooks

const contact = datagent.contact({ base: axios.create({ baseURL: "http://localhost:8081"  }) })
const userModel = datagent.model({
  name: 'user',
  url: 'users',
  contact,
  methods: {
    // 自定义方法，向服务端发送`[PATCH]`请求，屏蔽用户
    disabled(data, opts, ctx){
      // 最全的处理方法（推荐）
      const { origin } = {...opts}
      const { contact, url, getURL, emulateIdKey, isNew } = ctx.options
      const { id } = data
      const _url = getURL(id, url, emulateIdKey)
      return contact.remote(origin).patch(_url, {...data, disabled: true})
    },
    enabled(data, opts){
      //简单的处理方法
      const { origin } = {...opts}
      const { id } = data
      return this.contact.remote(origin).patch(this.getURL(id), {id, disabled: 1})
    }
  },
  hooks: {
    fetch: method=>[method(), respondData()],
    find: method=>[method(), respondData()],
    save: method=>[method(), respondData()],
    destroy: method=>[method(), respondData()],
    disabled: method=>[method(), respondData()]
  }
})

//对象名称
console.log(userModel.name)
// output: user

//获得用户数据列表
console.log(userModel.fetch({q: 'pa'}))
// request: [GET]'http://localhost:8081/users?q=pa'
// respond: { status: 200, data: [{id:1, username:'packy'}], headers: {...} }
// output: [{id:1, username:'packy'}]

//屏蔽用户
console.log(userModel.disabled({id:20}))
// request: [PATCH]'http://localhost:8081/users/20'
```

Returns **any** 

### fetch

获取数据列表

#### Parameters

-   `params` **[Object][84]** 请求参数，可选
-   `opts` **[Object][84]** 请求设置，可选
    -   `opts.origin` **[String][85]** 请求的远端名称
-   `ctx` **[Object][84]** 不用设置

Returns **[Promise][86]** 

### find

获取单个数据，根据id取得数据

#### Parameters

-   `params` **[Object][84]** 请求参数，可选
-   `opts` **[Object][84]** 请求设置，可选
    -   `opts.origin` **[String][85]** 请求的远端名称
-   `ctx` **[Object][84]** 不用设置

Returns **[Promise][86]** 

### save

储存数据，同步数据至远端，根据数据对象是否包含`id`进行新增或更新操作。

#### Parameters

-   `data` **[Object][84]** 发送数据，必须
-   `opts` **[Object][84]** 请求设置，可选
    -   `opts.origin` **[String][85]** 请求的远端名称
-   `ctx` **[Object][84]** 不用设置

Returns **[Promise][86]** 

### destroy

删除数据，根据id通知远端销毁数据。别名方法`delete()`

#### Parameters

-   `params` **[Object][84]** 请求参数，可选
-   `opts` **[Object][84]** 请求设置，可选
    -   `opts.origin` **[String][85]** 请求的远端名称
-   `ctx` **[Object][84]** 不用设置

Returns **[Promise][86]** 

## hooks

钩子

### respondData

用于钩子的方法，提取返回的结果。从`respond`中提取`data`内容传至下一个方法。

#### Examples

```javascript
import axios from 'axios'
import datagent from "datagent"
const { respondData } = datagent.hooks

const contact = datagent.contact({
  base: axios.create({ baseURL: 'localhost/api' })
})
 
const userModel = datagent.model({
  name: 'user',
  contact,
  hooks: {
      fetch: method=>[method(), respondData()]
  }
})
userModel.fetch().then(data=>console.log)
// [GET] localhost/api/user
// respond => { status: 200, data: [{id:1, name:'Tony'},{id:2, name:'Ben'}] }
// fetch => [{id:1, name:'Tony'},{id:2, name:'Ben'}]
```

Returns **any** 

### formatFor

用于钩子的方法，格式化数据。

#### Parameters

-   `schema` **[Schema][92]** 
-   `handle` **[Function][87]**  (optional, default `(ctx,format)=>ctx.result=format(ctx.result)`)

#### Examples

```javascript
import axios from 'axios'
import datagent from "datagent"
const { formatFor } = datagent.hooks

const contact = datagent.contact({
  base: axios.create({ baseURL: 'localhost/api' })
})

const userSchema = datagent.schema({
  id: { type: String, default: null },
  sex: { type: Number, default: 0 }
})
 
const userModel = datagent.model({
  name: 'user',
  contact,
  hooks: {
    fetch: method=>[method(), formatFor(userSchema, (ctx, format)=>ctx.result=ctx.result.data.map(format))]
  }
})
userModel.fetch().then(data=>console.log)
// [GET] localhost/api/user
// respond => { status: 200, data: [{id:1, name:'Tony'},{id:2, name:'Ben'}] }
// fetch => [{id:'1', name:'Tony'},{id:'2', name:'Ben'}]
```

Returns **any** 

### filterFor

用于钩子的方法，过滤对象字段。

#### Parameters

-   `schema` **[Schema][92]** 
-   `handle` **[Function][87]**  (optional, default `(ctx,filter)=>ctx.result=filter(ctx.result)`)

#### Examples

```javascript
import axios from 'axios'
import datagent from "datagent"
const { filterFor } = datagent.hooks

const contact = datagent.contact({
  base: axios.create({ baseURL: 'localhost/api' })
})

const userSchema = datagent.schema({
  id: { type: String, default: null },
  sex: { type: Number, default: 0 }
})
 
const userModel = datagent.model({
  name: 'user',
  contact,
  hooks: {
    fetch: method=>[
      filterFor(userSchema, (ctx, filter)=>{
        const [data, ...args] = ctx.args
        ctx.args=[filter(data), ...args]
      }),
      method()
    ]
  }
})
userModel.save({ name: 'cathy' })
// [POST] localhost/api/user
// request => { name: 'cathy', sex: 0 }
```

Returns **any** 

## axios

-   **See: [https://www.npmjs.com/package/axios][93]
    **

Promise based HTTP client for the browser and node.js

## axios.config

-   **See: [https://www.npmjs.com/package/axios#axios-api][94]
    **

Requests can be made by passing the relevant config to axios.

## Remote

远端，一般指后端服务，远端作为记录后端服务的功能节点

### Parameters

-   `origin` **[axios][95]** 服务源头，一般指`axios`

### Properties

-   `origin` **[axios][95]** 服务源头，一般指`axios`

### Examples

```javascript
import axios from "axios"
import datagent from "datagent"
const remote = datagent.remote(axios.create({ baseURL: "http://localhost:8081" }))

remote.get('/user', { q: "pa" }).then(res=>console.log(res))
// request 'http://localhost:8081/user?q=pa'
// output respond like: { status: 200, data: {...}, headers: {...} }
```

### sync

发起请求

#### Parameters

-   `options` **[axios.config][96]** 

Returns **[Promise][86]** 

### get

发起GET请求

#### Parameters

-   `url` **[String][85]** 请求地址
-   `params` **any** 请求参数

Returns **[Promise][86]** 

### post

发起POST请求

#### Parameters

-   `url` **[String][85]** 请求地址
-   `data` **any** 请求参数

Returns **[Promise][86]** 

### put

发起PUT请求

#### Parameters

-   `url` **[String][85]** 请求地址
-   `data` **any** 请求参数

Returns **[Promise][86]** 

### patch

发起PATCH请求

#### Parameters

-   `url` **[String][85]** 请求地址
-   `data` **any** 请求参数

Returns **[Promise][86]** 

### delete

发起DELETE请求

#### Parameters

-   `url` **[String][85]** 请求地址
-   `data` **any** 请求参数

Returns **[Promise][86]** 

## Schema

数据模型，记录并提供数据格式化操作

### Parameters

-   `fieldSet` **any** 字段设定 (optional, default `{}`)

### Properties

-   `fields` **[Array][83]&lt;[String][85]>** 字段名称列表
-   `fieldSet` **[Object][84]** 字段设定

### Examples

```javascript
import datagent from "datagent"
const userSchema = datagent.schema({
  id: { type: Number, default: null },
  username: { type: String, default: "" },
  nickname: { type: String, default: "" }
})

console.log(userSchema.fields)
// ['id', 'username', 'nickname']
```

### serialize

获得初次化的数据

#### Examples

```javascript
const user = userSchema.serialize()
console.log(user)
// { id: null, username: "", nickname: "" }
```

Returns **[Object][84]** 

### format

格式化数据，根据字段类型的设定转义数据

#### Parameters

-   `data` **[Object][84]** 原数据

#### Examples

```javascript
const user = userSchema.format({ id: "12345", username: "PackyTang", nickname: "packy" })
console.log(user)
// Id converted to numeric
// { id: 12345, username: "PackyTang", nickname: "packy" }
```

Returns **[Object][84]** 格式化后数据

### filter

过滤字段，移除所有未指定的字段数据

#### Parameters

-   `data` **[Object][84]** 原数据
-   `fields` **[Array][83]&lt;[String][85]>** 保留字段的列表 (optional, default `_fields`)

#### Examples

```javascript
const user = userSchema.filter({ id: "12345", username: "PackyTang", nickname: "packy" }, ['id','username'])
console.log(user)
// { id: "12345", username:"PackyTang" }
```

Returns **[Object][84]** 过滤后数据

[1]: #agent

[2]: #parameters

[3]: #properties

[4]: #examples

[5]: #active

[6]: #parameters-1

[7]: #fetch

[8]: #parameters-2

[9]: #find

[10]: #parameters-3

[11]: #save

[12]: #parameters-4

[13]: #destroy

[14]: #parameters-5

[15]: #on

[16]: #parameters-6

[17]: #agentbefore

[18]: #properties-1

[19]: #agenterror

[20]: #agentafter

[21]: #properties-2

[22]: #contact

[23]: #parameters-7

[24]: #examples-1

[25]: #has

[26]: #parameters-8

[27]: #default

[28]: #parameters-9

[29]: #remote

[30]: #parameters-10

[31]: #examples-2

[32]: #model

[33]: #parameters-11

[34]: #properties-3

[35]: #examples-3

[36]: #fetch-1

[37]: #parameters-12

[38]: #find-1

[39]: #parameters-13

[40]: #save-1

[41]: #parameters-14

[42]: #destroy-1

[43]: #parameters-15

[44]: #hooks

[45]: #responddata

[46]: #examples-4

[47]: #formatfor

[48]: #parameters-16

[49]: #examples-5

[50]: #filterfor

[51]: #parameters-17

[52]: #examples-6

[53]: #axios

[54]: #axiosconfig

[55]: #remote-1

[56]: #parameters-18

[57]: #properties-4

[58]: #examples-7

[59]: #sync

[60]: #parameters-19

[61]: #get

[62]: #parameters-20

[63]: #post

[64]: #parameters-21

[65]: #put

[66]: #parameters-22

[67]: #patch

[68]: #parameters-23

[69]: #delete

[70]: #parameters-24

[71]: #schema

[72]: #parameters-25

[73]: #properties-5

[74]: #examples-8

[75]: #serialize

[76]: #examples-9

[77]: #format

[78]: #parameters-26

[79]: #examples-10

[80]: #filter

[81]: #parameters-27

[82]: #examples-11

[83]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[84]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[85]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[86]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[87]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[88]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error

[89]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[90]: #remote

[91]: #contact

[92]: #schema

[93]: https://www.npmjs.com/package/axios

[94]: https://www.npmjs.com/package/axios#axios-api

[95]: #axios

[96]: #axiosconfig
